import{useRef as n,useCallback as e,useState as t,useMemo as o}from"react";function r(){return r=Object.assign||function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(n[o]=t[o])}return n},r.apply(this,arguments)}function a(){}const s=(n,e)=>t=>Math.max(n,Math.min(t,e));function i(n,e){return Math.sqrt(Math.pow(n.x-e.x,2)+Math.pow(n.y-e.y,2))}function f(n,e){const t=r({},e);for(;n;)t.x-=n.offsetLeft,t.y-=n.offsetTop,n=n.offsetParent;return t}function c({enablePan:c=!0,enableZoom:m=!0,requireCtrlToZoom:u=!1,disableWheel:p=!1,panOnDrag:y=!0,preventClickOnPan:g=!0,zoomSensitivity:x=.01,minZoom:l=0,maxZoom:h=Infinity,minX:v=-Infinity,maxX:P=Infinity,minY:d=-Infinity,maxY:M=Infinity,initialZoom:z=1,initialPan:w={x:0,y:0},onPanStart:Y=a,onPan:Z=a,onPanEnd:E=a,onZoom:L=a}={}){const X=n(null),C=function(){const[,n]=t(!1);return e(()=>{n(n=>!n)},[])}(),[D,T]=function(t){const o=n(t);return[e(()=>o.current,[]),e(n=>(o.current="function"==typeof n?n(o.current):n,o.current),[])]}({wasPanning:!1,isPanning:!1,prevPointers:[],prevZoom:1,center:{x:0,y:0},transform:r({},w,{zoom:z})}),b=o(()=>s(v,P),[v,P]),I=o(()=>s(d,M),[d,M]),O=o(()=>s(l,h),[l,h]),A=e(n=>{const e=X.current,t=D();return e&&(t.transform="function"==typeof n?n(t.transform):n,t.center.x=(e.offsetWidth/2-t.transform.x)/t.transform.zoom,t.center.y=(e.offsetHeight/2-t.transform.y)/t.transform.zoom,T(t),C()),t.transform},[D,T,C]),H=e(n=>A(({x:e,y:t,zoom:o})=>{const r="function"==typeof n?n({x:e,y:t}):n;return{x:b(r.x),y:I(r.y),zoom:o}}),[b,I,A]),S=e((n,e)=>{const t=X.current;t&&A(({x:o,y:r,zoom:a})=>{const s=O("function"==typeof n?n(a):n),i=e?{x:e.x-t.offsetWidth/2,y:e.y-t.offsetHeight/2}:{x:0,y:0};return{x:b(o+(i.x-o)*(a-s)/a),y:I(r+(i.y-r)*(a-s)/a),zoom:s}})},[b,I,O,A]),W=e(n=>{if(c){const e=D();e.prevPointers=n,e.isPanning=!0,T(e),Y(n,e.transform)}},[c,Y,T,D]),$=e(n=>{const e=D();if(e.isPanning){e.wasPanning=!0;const t=e.prevPointers;e.prevPointers=n,T(e);let o=0,r=0;const a=Math.min(n.length,t.length,2);for(let e=0;e<a;e++)o+=n[e].x-t[e].x,r+=n[e].y-t[e].y;o/=a,r/=a;const s=2===a?i(n[0],n[1])/i(t[0],t[1]):1;H(({x:n,y:e})=>({x:n+o,y:e+r})),S(n=>n*s),C(),Z(n,D().transform)}},[Z,H,S,D,T,C]),j=e(()=>{D().isPanning&&(T(n=>r({},n,{isPanning:!1})),E())},[E,D,T]),k=e(n=>{const e=D();g&&e.wasPanning&&(T(n=>r({},n,{wasPanning:!1})),n.stopPropagation())},[g,D,T]),q=e(n=>{if(m&&X.current)if(n.preventDefault(),!u||n.ctrlKey){const e=f(X.current,{x:n.pageX,y:n.pageY});let t=n.deltaY;1===n.deltaMode&&(t*=15),S(n=>n*Math.pow(1-x,t),e),L(D().transform)}else H(({x:e,y:t})=>({x:e-n.deltaX,y:t-n.deltaY}))},[m,u,x,L,H,S,D]),K=e(n=>{n.preventDefault(),T(n=>r({},n,{prevZoom:n.transform.zoom}))},[T]),U=e(n=>{n.preventDefault();const e=f(X.current,{x:n.pageX,y:n.pageY});S(D().prevZoom*n.scale,e),L(D().transform)},[S,L,D]),B=e(n=>{if(n)p||n.addEventListener("wheel",q),n.addEventListener("gesturestart",K),n.addEventListener("gesturechange",U),n.addEventListener("gestureend",U);else if(X.current)return()=>{const n=X.current;n&&(p||n.removeEventListener("wheel",q),n.removeEventListener("gesturestart",K),n.removeEventListener("gesturechange",U),n.removeEventListener("gestureend",U))};X.current=n},[q,K,U,p]),F=e(n=>W(Array.from(n.touches).map(({pageX:n,pageY:e})=>({x:n,y:e}))),[W]),G=e(n=>$(Array.from(n.touches).map(({pageX:n,pageY:e})=>({x:n,y:e}))),[$]),J=e(n=>{0===n.touches.length?j():W(Array.from(n.touches).map(({pageX:n,pageY:e})=>({x:n,y:e})))},[j,W]),N=e(n=>W([{x:n.pageX,y:n.pageY}]),[W]),Q=e(n=>$([{x:n.pageX,y:n.pageY}]),[$]),R=D();return{container:X.current,setContainer:B,transform:`translate3D(${R.transform.x}px, ${R.transform.y}px, 0) scale(${R.transform.zoom})`,center:R.center,pan:{x:R.transform.x,y:R.transform.y},zoom:R.transform.zoom,setPan:H,setZoom:S,panZoomHandlers:y?{onTouchStart:F,onTouchMove:G,onTouchEnd:J,onTouchCancel:J,onMouseDown:N,onMouseMove:Q,onMouseUp:j,onMouseLeave:j,onClickCapture:k}:{}}}export{c as default};
//# sourceMappingURL=index.modern.js.map
